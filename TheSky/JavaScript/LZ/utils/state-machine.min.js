(function(){
  vara={
    VERSION: "2.3.5",
    Result: {
      SUCCEEDED: 1,
      NOTRANSITION: 2,
      CANCELLED: 3,
      PENDING: 4
    },
    Error: {
      INVALID_TRANSITION: 100,
      PENDING_TRANSITION: 200,
      INVALID_CALLBACK: 300
    },
    WILDCARD: "*",
    ASYNC: "async",
    create: function(g,
    h){
      varj=(typeofg.initial=="string")?{
        state: g.initial
      }: g.initial;varf=g.terminal||g[
        "final"
      ];vare=h||g.target||{
        
      };varm=g.events||[
        
      ];vari=g.callbacks||{
        
      };varc={
        
      };vark={
        
      };varl=function(o){
        varq=(o.frominstanceofArray)?o.from: (o.from?[
          o.from
        ]: [
          a.WILDCARD
        ]);c[
          o.name
        ]=c[
          o.name
        ]||{
          
        };for(varp=0;p<q.length;p++){
          k[
            q[
              p
            ]
          ]=k[
            q[
              p
            ]
          ]||[
            
          ];k[
            q[
              p
            ]
          ].push(o.name);c[
            o.name
          ][
            q[
              p
            ]
          ]=o.to||q[
            p
          ]
        }
      };if(j){
        j.event=j.event||"startup";l({
          name: j.event,
          from: "none",
          to: j.state
        })
      }for(vard=0;d<m.length;d++){
        l(m[
          d
        ])
      }for(varbinc){
        if(c.hasOwnProperty(b)){
          e[
            b
          ]=a.buildEvent(b,
          c[
            b
          ])
        }
      }for(varbini){
        if(i.hasOwnProperty(b)){
          e[
            b
          ]=i[
            b
          ]
        }
      }e.current="none";e.is=function(n){
        return(ninstanceofArray)?(n.indexOf(this.current)>=0): (this.current===n)
      };e.can=function(n){
        return!this.transition&&(c[
          n
        ].hasOwnProperty(this.current)||c[
          n
        ].hasOwnProperty(a.WILDCARD))
      };e.cannot=function(n){
        return!this.can(n)
      };e.transitions=function(){
        returnk[
          this.current
        ]
      };e.isFinished=function(){
        returnthis.is(f)
      };e.error=g.error||function(p,
      t,
      s,
      o,
      n,
      r,
      q){
        throwq||r
      };if(j&&!j.defer){
        e[
          j.event
        ]()
      }returne
    },
    doCallback: function(g,
    d,
    c,
    i,
    h,
    b){
      if(d){
        try{
          returnd.apply(g,
          [
            c,
            i,
            h
          ].concat(b))
        }catch(f){
          returng.error(c,
          i,
          h,
          b,
          a.Error.INVALID_CALLBACK,
          "an exception occurred in a caller-provided callback function",
          f)
        }
      }
    },
    beforeAnyEvent: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d.onbeforeevent,
      c,
      f,
      e,
      b)
    },
    afterAnyEvent: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d.onafterevent||d.onevent,
      c,
      f,
      e,
      b)
    },
    leaveAnyState: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d.onleavestate,
      c,
      f,
      e,
      b)
    },
    enterAnyState: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d.onenterstate||d.onstate,
      c,
      f,
      e,
      b)
    },
    changeState: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d.onchangestate,
      c,
      f,
      e,
      b)
    },
    beforeThisEvent: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d[
        "onbefore"+c
      ],
      c,
      f,
      e,
      b)
    },
    afterThisEvent: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d[
        "onafter"+c
      ]||d[
        "on"+c
      ],
      c,
      f,
      e,
      b)
    },
    leaveThisState: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d[
        "onleave"+f
      ],
      c,
      f,
      e,
      b)
    },
    enterThisState: function(d,
    c,
    f,
    e,
    b){
      returna.doCallback(d,
      d[
        "onenter"+e
      ]||d[
        "on"+e
      ],
      c,
      f,
      e,
      b)
    },
    beforeEvent: function(d,
    c,
    f,
    e,
    b){
      if((false===a.beforeThisEvent(d,
      c,
      f,
      e,
      b))||(false===a.beforeAnyEvent(d,
      c,
      f,
      e,
      b))){
        returnfalse
      }
    },
    afterEvent: function(d,
    c,
    f,
    e,
    b){
      a.afterThisEvent(d,
      c,
      f,
      e,
      b);a.afterAnyEvent(d,
      c,
      f,
      e,
      b)
    },
    leaveState: function(f,
    e,
    h,
    g,
    d){
      varc=a.leaveThisState(f,
      e,
      h,
      g,
      d),
      b=a.leaveAnyState(f,
      e,
      h,
      g,
      d);if((false===c)||(false===b)){
        returnfalse
      }else{
        if((a.ASYNC===c)||(a.ASYNC===b)){
          returna.ASYNC
        }
      }
    },
    enterState: function(d,
    c,
    f,
    e,
    b){
      a.enterThisState(d,
      c,
      f,
      e,
      b);a.enterAnyState(d,
      c,
      f,
      e,
      b)
    },
    buildEvent: function(b,
    c){
      returnfunction(){
        varh=this.current;varg=c[
          h
        ]||c[
          a.WILDCARD
        ]||h;vare=Array.prototype.slice.call(arguments);if(this.transition){
          returnthis.error(b,
          h,
          g,
          e,
          a.Error.PENDING_TRANSITION,
          "event "+b+" inappropriate because previous transition did not complete")
        }if(this.cannot(b)){
          returnthis.error(b,
          h,
          g,
          e,
          a.Error.INVALID_TRANSITION,
          "event "+b+" inappropriate in current state "+this.current)
        }if(false===a.beforeEvent(this,
        b,
        h,
        g,
        e)){
          returna.Result.CANCELLED
        }if(h===g){
          a.afterEvent(this,
          b,
          h,
          g,
          e);returna.Result.NOTRANSITION
        }varf=this;this.transition=function(){
          f.transition=null;f.current=g;a.enterState(f,
          b,
          h,
          g,
          e);a.changeState(f,
          b,
          h,
          g,
          e);a.afterEvent(f,
          b,
          h,
          g,
          e);returna.Result.SUCCEEDED
        };this.transition.cancel=function(){
          f.transition=null;a.afterEvent(f,
          b,
          h,
          g,
          e)
        };vard=a.leaveState(this,
        b,
        h,
        g,
        e);if(false===d){
          this.transition=null;returna.Result.CANCELLED
        }else{
          if(a.ASYNC===d){
            returna.Result.PENDING
          }else{
            if(this.transition){
              returnthis.transition()
            }
          }
        }
      }
    }
  };if(typeofexports!=="undefined"){
    if(typeofmodule!=="undefined"&&module.exports){
      exports=module.exports=a
    }exports.StateMachine=a
  }else{
    if(typeofdefine==="function"&&define.amd){
      define(function(b){
        returna
      })
    }else{
      if(typeofwindow!=="undefined"){
        window.StateMachine=a
      }else{
        if(typeofself!=="undefined"){
          self.StateMachine=a
        }
      }
    }
  }
}());